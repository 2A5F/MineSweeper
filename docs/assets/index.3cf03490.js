var A=Object.defineProperty;var O=(n,e,t)=>e in n?A(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var h=(n,e,t)=>(O(n,typeof e!="symbol"?e+"":e,t),t);import{M as u,r as b,s as m,j as z,a as d,u as P,b as $,c as L,d as k,e as T,f as E,R as W,g as G}from"./vendor.688ab2ae.js";const I=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const f of a.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&i(f)}).observe(document,{childList:!0,subtree:!0});function t(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerpolicy&&(a.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?a.credentials="include":s.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(s){if(s.ep)return;s.ep=!0;const a=t(s);fetch(s.href,a)}};I();var x;(function(n){function e(i){switch(i){case"up":return"down";case"down":return"up";case"left":return"right";case"right":return"left";case"upLeft":return"downRight";case"upRight":return"downLeft";case"downLeft":return"upRight";case"downRight":return"upLeft"}}n.rev=e;function t(i,s){switch(i){case null:case void 0:return s==null;case"up":return s==="up"||s==="upLeft"||s==="upRight";case"down":return s==="down"||s==="downLeft"||s==="downRight";case"left":return s==="left"||s==="upLeft"||s==="downLeft";case"right":return s==="right"||s==="upRight"||s==="downRight";case"upLeft":return s==="upLeft"||s==="up"||s==="left";case"upRight":return s==="upRight"||s==="up"||s==="right";case"downLeft":return s==="downLeft"||s==="down"||s==="left";case"downRight":return s==="downRight"||s==="down"||s==="right"}}n.same=t})(x||(x={}));class w{constructor(e,t){this.x=e,this.y=t}static byIndex(e,t){return new w(e%t.width,e/t.width|0)}get str(){return`${this.x},${this.y}`}index(e){return this.y*e.width+this.x}mapX(e){return new w(e(this.x),this.y)}mapY(e){return new w(this.x,e(this.y))}left(e){return this.x>0?this.mapX(t=>t-1):null}right(e){return this.x<e.width-1?this.mapX(t=>t+1):null}up(e){return this.y>0?this.mapY(t=>t-1):null}down(e){return this.y<e.height-1?this.mapY(t=>t+1):null}upLeft(e){return this.up(e)?.left(e)}upRight(e){return this.up(e)?.right(e)}downLeft(e){return this.down(e)?.left(e)}downRight(e){return this.down(e)?.right(e)}forRound(e,t){u.then(this.up(e),t),u.then(this.down(e),t),u.then(this.left(e),t),u.then(this.right(e),t),u.then(this.upLeft(e),t),u.then(this.upRight(e),t),u.then(this.downLeft(e),t),u.then(this.downRight(e),t)}forRoundWithDire(e,t,i){t("up")&&u.then(this.up(e),s=>i(s,"up")),t("down")&&u.then(this.down(e),s=>i(s,"down")),t("left")&&u.then(this.left(e),s=>i(s,"left")),t("right")&&u.then(this.right(e),s=>i(s,"right")),t("upLeft")&&u.then(this.upLeft(e),s=>i(s,"upLeft")),t("upRight")&&u.then(this.upRight(e),s=>i(s,"upRight")),t("downLeft")&&u.then(this.downLeft(e),s=>i(s,"downLeft")),t("downRight")&&u.then(this.downRight(e),s=>i(s,"downRight"))}}function Y(n,e){return new w(n,e)}class q{constructor(e){h(this,"bucket");this.bucket=[...e]}*[Symbol.iterator](){for(const e of b(this.bucket.length-1,0)){const t=Math.random()*e|0;yield([this.bucket[t],this.bucket[e]]=[this.bucket[e],this.bucket[t]])[1]}}}class X{constructor(e,t){this.width=e,this.height=t}get size(){return this.width*this.height}}function K(n,e){return new X(n,e)}function N(...n){return m(n).filter(e=>e).map(e=>typeof e=="string"?e:e instanceof Array?N(...e):m(Object.entries(e)).filter(([,t])=>t).map(([t])=>t).filter(t=>t).join(" ")).filter(e=>e).join(" ")}function M(...n){const e=N(...n);return e?` ${e}`:""}function U(n,e){const[t,i]=n.from>n.to?[n.to,n.from]:[n.from,n.to];return e>=t&&e<=i}const r=z.exports.jsx,y=z.exports.jsxs;function H({onRestart:n,face:e,last:t,startTime:i,endTime:s}){return y("div",{className:"bar flex justify-between items-center",children:[r(R,{n:t}),r(J,{onRestart:n,face:e}),r(Q,{startTime:i,endTime:s})]})}function J({onRestart:n,face:e}){return r("div",{className:`face ${e}`,onClick:n})}function R({n}){const e=`${n|0}`.padStart(3,"0");return y("div",{className:"num flex",children:[r(B,{n:e[0]??0}),r(B,{n:e[1]??0}),r(B,{n:e[2]??0})]})}function B({n}){return r("div",{className:"num-item",children:n!=null?r("div",{className:`n n-${n}`}):null})}function Q({startTime:n,endTime:e}){const[t]=d.exports.useState({startTime:n,endTime:e});t.startTime=n,t.endTime=e;const i=d.exports.useRef(0),[s,a]=d.exports.useState(0);return d.exports.useEffect(()=>{const f=()=>{i.current=requestAnimationFrame(f);const{startTime:g,endTime:v}=t;if(g==null||v!=null)return;const _=(new Date().getTime()-g.getTime())/1e3;_!=s&&a(_)};return f(),()=>{cancelAnimationFrame(i.current)}},[]),n==null?r(R,{n:0}):e!=null?r(R,{n:(e.getTime()-n.getTime())/1e3}):r(R,{n:s})}var V=d.exports.forwardRef(function({cell:e,won:t,dead:i},s){return r("div",{ref:s,className:`cell${M({preview:e.preview,open:e.open||e.preview||e.boom||i&&(!e.hasBomb&&e.hasFlag||e.hasBomb&&!e.hasFlag),bomb:(e.open||t||i)&&e.hasBomb,flag:e.hasFlag||t&&e.hasBomb,boom:e.boom},e.open&&!e.hasBomb&&e.num?`n-${e.num}`:null)}`,pos:e.pos.str})});function Z({size:n,grid:e,onRestart:t,onMsg:i,won:s,dead:a,last:f,startTime:g,endTime:v}){const[p,_]=d.exports.useState(!0);P(()=>_(!1));const F=$(),[l]=d.exports.useState(()=>({buttons:0,cell:null,cell2dom:new Map,dom2cell:new WeakMap}));L("mousedown",o=>{switch(l.buttons=o.buttons,F(),l.buttons){case 3:case 4:const c=l.dom2cell.get(o.target)??null;c!=null&&(l.cell=c,i({type:"preview",pos:c.pos,cell:c}));break}}),L("mouseup",()=>{const o=l.cell;if(o!=null)switch(l.buttons){case 1:i({type:"open",pos:o.pos,cell:o});break;case 2:i({type:"flag",cell:o});break;case 3:case 4:i({type:"round",pos:o.pos,cell:o});break}l.buttons=0,F()}),L("mousemove",o=>{switch(l.buttons){case 3:case 4:const c=l.dom2cell.get(o.target)??null;c!=null&&(l.cell=c,i({type:"preview",pos:c.pos,cell:c}));break}});const D=s?"won":a?"dead":l.buttons!=0?"click":"normal";return y("div",{className:`board flex flex-col xp${M({won:s,dead:a})}`,children:[r(H,{onRestart:t,face:D,last:f,startTime:g,endTime:v}),r("div",{className:"grid",style:{gridTemplateColumns:`repeat(${n.width}, 1fr)`,gridTemplateRows:`repeat(${n.height}, 1fr)`},onMouseDown:o=>{l.cell=l.dom2cell.get(o.target)??null},children:e.map(o=>r(V,{ref:c=>{c!=null&&(l.cell2dom.set(o,c),l.dom2cell.set(c,o))},cell:o,won:s,dead:a},o.pos.str))})]})}function ee({theme:n}){const e=te(),t=d.exports.useMemo(()=>{switch(n){case"xp":default:return Z}},[n]);return r("div",{className:"game grid place-self-center",children:r(t,{size:e.size,grid:e.grid,won:e.won,dead:e.dead,last:e.last,startTime:e.startTime,endTime:e.endTime,onRestart:()=>e.restart(),onMsg:i=>e.send(i)})})}class S{constructor(e){h(this,"_lock",!1);h(this,"randge",null);h(this,"_playing",!1);h(this,"_end",!1);h(this,"_dead",!1);h(this,"_won",!1);h(this,"_size",K(9,9));h(this,"_bombs",10);h(this,"_last",this._bombs);h(this,"_grid",[]);h(this,"_firstSafe",1);h(this,"_flags",new Set);h(this,"_opening",0);h(this,"_startTime",null);h(this,"_endTime",null);h(this,"_preview",[]);this.update=e,this.init()}get playing(){return this._playing}get end(){return this._end}get dead(){return this._dead}get won(){return this._won}get size(){return this._size}get bombs(){return this._bombs}get last(){return this._last}get grid(){return this._grid}get firstSafe(){return this._firstSafe}get flags(){return this._flags.size}get opening(){return this._opening}get startTime(){return this._startTime}get endTime(){return this._endTime}init(){this._grid=m(k(this.size.height)).flatMap(e=>m(k(this.size.width)).map(t=>new se(Y(t,e)))).collect(),this.randge=new q(k(this.size.size))}restart(e=this.size,t=this.bombs,i=this.firstSafe){this._size=e,this._bombs=t,this._last=t,this._opening=0,this._flags.clear(),this._firstSafe=i,this._playing=!1,this._end=!1,this._won=!1,this._dead=!1,this._startTime=null,this._endTime=null,this.init(),this.update()}async send(e){if(!this.end&&!this._lock){switch(this._lock=!0,e.type){case"open":this.playing?await this.openCell(e.pos,e.cell):await this.start(e.pos,e.cell);break;case"round":this.stopPreview(),this.playing&&await this.openRound(e.pos,e.cell);break;case"flag":this.setFlag(e.cell);break;case"preview":this.preview(e.pos,e.cell);break}this._lock=!1}}async start(e,t){this._playing=!0,this._startTime=new Date,this.genBombs(e),await this.openSpace(e,t),this.update()}genBombs(e){const t=[T(e.index(this.size),i=>b(i-this.firstSafe,i+this.firstSafe)),...m(E(1,this.firstSafe)).flatMap(i=>[T(e.mapY(s=>s-i).index(this.size),s=>b(s-this.firstSafe,s+this.firstSafe)),T(e.mapY(s=>s+i).index(this.size),s=>b(s-this.firstSafe,s+this.firstSafe))])];for(const i of m(this.randge).filter(s=>!m(t).any(a=>U(a,s))).take(this.bombs).map(s=>this.grid[s]))i.hasBomb=!0;for(const[i,s]of m(this.grid).enumerate())w.byIndex(s,this.size).forRound(this.size,a=>{this.grid[a.index(this.size)].hasBomb&&i.num++})}async openSpace(e,t){if(t.hasFlag)return;if(t.hasBomb)return this.die(t);t.open||(t.open=!0,this._opening++);let i=new Map([[e,null]]),s=new Map;try{do{for(const[a,f]of i)a.forRoundWithDire(this.size,g=>!x.same(g,f),(g,v)=>{const p=this.grid[g.index(this.size)];if(!(p.open||p.hasFlag)){if(p.hasBomb)throw this.die(p),S;p.open||(p.open=!0,this._opening++),p.num==0&&!p.hasBomb&&s.set(g,x.rev(v))}});i.clear(),[i,s]=[s,i]}while(i.size)}catch(a){if(a===S)return}!this.checkWin()}async openCell(e,t){if(!t.open&&!t.hasFlag){if(t.hasBomb)return this.die(t);if(t.num==0)return await this.openSpace(e,t);t.open=!0,this._opening++,!this.checkWin()&&this.update()}}async openRound(e,t){if(!t.open)return;let i=0;e.forRound(this.size,s=>{this.grid[s.index(this.size)].hasFlag&&i++}),i===t.num&&(this.openSpace(e,t),this.update())}setFlag(e){e.open||(e.hasFlag?(e.hasFlag=!1,this._last++,this._flags.delete(e)):(e.hasFlag=!0,this._last--,this._flags.add(e)),this.update())}preview(e,t){this.clearPreview(),this._preview.push(t),t.preview=!0,e.forRound(this.size,i=>{const s=this.grid[i.index(this.size)];s.hasFlag||(s.preview=!0,this._preview.push(s))}),this.update()}clearPreview(){for(const e of this._preview)e.preview=!1;this._preview.length=0}stopPreview(){this._preview.length>0&&(this.clearPreview(),this.update())}die(e){this._endTime=new Date,e.boom=!0,this._end=!0,this._dead=!0,this.clearPreview(),this.update()}checkWin(){return this.size.size-this.opening===this.bombs?(this.win(),!0):!1}win(){this._endTime=new Date,this._last=0,this._end=!0,this._won=!0,this.clearPreview(),this.update()}}const C=d.exports.createContext(null);function te(){return d.exports.useContext(C)}class se{constructor(e){h(this,"hasBomb",!1);h(this,"hasFlag",!1);h(this,"open",!1);h(this,"preview",!1);h(this,"boom",!1);h(this,"num",0);this.pos=e}}function ie(){const n=$(),e=d.exports.useState(()=>new S(n))[0];return r(C.Provider,{value:e,children:r(ee,{theme:"xp"})})}function ne(){return r("div",{id:"github",title:"Source code",children:r("a",{href:"https://github.com/2A5F/MineSweeper",target:"_blank",children:r("svg",{height:"32","aria-hidden":"true",viewBox:"0 0 16 16",version:"1.1",width:"32","data-view-component":"true",children:r("path",{"fill-rule":"evenodd",d:"M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"})})})})}const j=document.getElementById("root");j.addEventListener("contextmenu",n=>n.preventDefault());W.render(y(G.StrictMode,{children:[r(ne,{}),r(ie,{})]}),j);

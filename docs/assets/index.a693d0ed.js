var O=Object.defineProperty;var P=(n,e,t)=>e in n?O(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var a=(n,e,t)=>(P(n,typeof e!="symbol"?e+"":e,t),t);import{M as u,r as b,s as g,j as z,a as f,u as A,b as N,c as L,d as S,e as k,f as E,R as W,g as I}from"./vendor.688ab2ae.js";const Y=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const d of r.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&i(d)}).observe(document,{childList:!0,subtree:!0});function t(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerpolicy&&(r.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?r.credentials="include":s.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=t(s);fetch(s.href,r)}};Y();var x;(function(n){function e(i){switch(i){case"up":return"down";case"down":return"up";case"left":return"right";case"right":return"left";case"upLeft":return"downRight";case"upRight":return"downLeft";case"downLeft":return"upRight";case"downRight":return"upLeft"}}n.rev=e;function t(i,s){switch(i){case null:case void 0:return s==null;case"up":return s==="up"||s==="upLeft"||s==="upRight";case"down":return s==="down"||s==="downLeft"||s==="downRight";case"left":return s==="left"||s==="upLeft"||s==="downLeft";case"right":return s==="right"||s==="upRight"||s==="downRight";case"upLeft":return s==="upLeft"||s==="up"||s==="left";case"upRight":return s==="upRight"||s==="up"||s==="right";case"downLeft":return s==="downLeft"||s==="down"||s==="left";case"downRight":return s==="downRight"||s==="down"||s==="right"}}n.same=t})(x||(x={}));class w{constructor(e,t){this.x=e,this.y=t}static byIndex(e,t){return new w(e%t.width,e/t.width|0)}get str(){return`${this.x},${this.y}`}index(e){return this.y*e.width+this.x}mapX(e){return new w(e(this.x),this.y)}mapY(e){return new w(this.x,e(this.y))}left(e){return this.x>0?this.mapX(t=>t-1):null}right(e){return this.x<e.width-1?this.mapX(t=>t+1):null}up(e){return this.y>0?this.mapY(t=>t-1):null}down(e){return this.y<e.height-1?this.mapY(t=>t+1):null}upLeft(e){return this.up(e)?.left(e)}upRight(e){return this.up(e)?.right(e)}downLeft(e){return this.down(e)?.left(e)}downRight(e){return this.down(e)?.right(e)}forRound(e,t){u.then(this.up(e),t),u.then(this.down(e),t),u.then(this.left(e),t),u.then(this.right(e),t),u.then(this.upLeft(e),t),u.then(this.upRight(e),t),u.then(this.downLeft(e),t),u.then(this.downRight(e),t)}forRoundWithDire(e,t,i){t("up")&&u.then(this.up(e),s=>i(s,"up")),t("down")&&u.then(this.down(e),s=>i(s,"down")),t("left")&&u.then(this.left(e),s=>i(s,"left")),t("right")&&u.then(this.right(e),s=>i(s,"right")),t("upLeft")&&u.then(this.upLeft(e),s=>i(s,"upLeft")),t("upRight")&&u.then(this.upRight(e),s=>i(s,"upRight")),t("downLeft")&&u.then(this.downLeft(e),s=>i(s,"downLeft")),t("downRight")&&u.then(this.downRight(e),s=>i(s,"downRight"))}}function q(n,e){return new w(n,e)}class G{constructor(e){a(this,"bucket");this.bucket=[...e]}*[Symbol.iterator](){for(const e of b(this.bucket.length-1,0)){const t=Math.random()*e|0;yield([this.bucket[t],this.bucket[e]]=[this.bucket[e],this.bucket[t]])[1]}}}class X{constructor(e,t){this.width=e,this.height=t}get size(){return this.width*this.height}}function K(n,e){return new X(n,e)}function $(...n){return g(n).filter(e=>e).map(e=>typeof e=="string"?e:e instanceof Array?$(...e):g(Object.entries(e)).filter(([,t])=>t).map(([t])=>t).filter(t=>t).join(" ")).filter(e=>e).join(" ")}function M(...n){const e=$(...n);return e?` ${e}`:""}function U(n,e){const[t,i]=n.from>n.to?[n.to,n.from]:[n.from,n.to];return e>=t&&e<=i}const h=z.exports.jsx,T=z.exports.jsxs;function H({onRestart:n,face:e,last:t,startTime:i,endTime:s}){return T("div",{className:"bar flex justify-between items-center",children:[h(y,{n:t}),h(J,{onRestart:n,face:e}),h(Q,{startTime:i,endTime:s})]})}function J({onRestart:n,face:e}){return h("div",{className:`face ${e}`,onClick:n})}function y({n}){const e=`${n|0}`.padStart(3,"0");return T("div",{className:"num flex",children:[h(B,{n:e[0]??0}),h(B,{n:e[1]??0}),h(B,{n:e[2]??0})]})}function B({n}){return h("div",{className:"num-item",children:n!=null?h("div",{className:`n n-${n}`}):null})}function Q({startTime:n,endTime:e}){const[t]=f.exports.useState({startTime:n,endTime:e});t.startTime=n,t.endTime=e;const i=f.exports.useRef(0),[s,r]=f.exports.useState(0);return f.exports.useEffect(()=>{const d=()=>{i.current=requestAnimationFrame(d);const{startTime:m,endTime:_}=t;if(m==null||_!=null)return;const v=(new Date().getTime()-m.getTime())/1e3;v!=s&&r(v)};return d(),()=>{cancelAnimationFrame(i.current)}},[]),n==null?h(y,{n:0}):e!=null?h(y,{n:(e.getTime()-n.getTime())/1e3}):h(y,{n:s})}var V=f.exports.forwardRef(function({cell:e,won:t,dead:i},s){return h("div",{ref:s,className:`cell${M({preview:e.preview,open:e.open||e.preview||e.boom||i&&(!e.hasBomb&&e.hasFlag||e.hasBomb&&!e.hasFlag),bomb:(e.open||t||i)&&e.hasBomb,flag:e.hasFlag||t&&e.hasBomb,boom:e.boom},e.open&&!e.hasBomb&&e.num?`n-${e.num}`:null)}`,pos:e.pos.str})});function Z({size:n,grid:e,onRestart:t,onMsg:i,won:s,dead:r,last:d,startTime:m,endTime:_}){const[p,v]=f.exports.useState(!0);A(()=>v(!1));const F=N(),[l]=f.exports.useState(()=>({buttons:0,cell:null,cell2dom:new Map,dom2cell:new WeakMap}));L("mousedown",o=>{switch(l.buttons=o.buttons,F(),l.buttons){case 3:case 4:const c=l.dom2cell.get(o.target)??null;c!=null&&(l.cell=c,i({type:"preview",pos:c.pos,cell:c}));break}}),L("mouseup",()=>{const o=l.cell;if(o!=null)switch(l.buttons){case 1:i({type:"open",pos:o.pos,cell:o});break;case 2:i({type:"flag",cell:o});break;case 3:case 4:i({type:"round",pos:o.pos,cell:o});break}l.buttons=0,F()}),L("mousemove",o=>{switch(l.buttons){case 3:case 4:const c=l.dom2cell.get(o.target)??null;c!=null&&(l.cell=c,i({type:"preview",pos:c.pos,cell:c}));break}});const D=s?"won":r?"dead":l.buttons!=0?"click":"normal";return T("div",{className:`board flex flex-col xp${M({won:s,dead:r})}`,children:[h(H,{onRestart:t,face:D,last:d,startTime:m,endTime:_}),h("div",{className:"grid",style:{gridTemplateColumns:`repeat(${n.width}, 1fr)`,gridTemplateRows:`repeat(${n.height}, 1fr)`},onMouseDown:o=>{l.cell=l.dom2cell.get(o.target)??null},children:e.map(o=>h(V,{ref:c=>{c!=null&&(l.cell2dom.set(o,c),l.dom2cell.set(c,o))},cell:o,won:s,dead:r},o.pos.str))})]})}function ee({theme:n}){const e=te(),t=f.exports.useMemo(()=>{switch(n){case"xp":default:return Z}},[n]);return h("div",{className:"game grid place-self-center",children:h(t,{size:e.size,grid:e.grid,won:e.won,dead:e.dead,last:e.last,startTime:e.startTime,endTime:e.endTime,onRestart:()=>e.restart(),onMsg:i=>e.send(i)})})}class R{constructor(e){a(this,"_lock",!1);a(this,"randge",null);a(this,"_playing",!1);a(this,"_end",!1);a(this,"_dead",!1);a(this,"_won",!1);a(this,"_size",K(9,9));a(this,"_bombs",10);a(this,"_last",this._bombs);a(this,"_grid",[]);a(this,"_firstSafe",1);a(this,"_flags",new Set);a(this,"_opening",0);a(this,"_startTime",null);a(this,"_endTime",null);a(this,"_preview",[]);this.update=e,this.init()}get playing(){return this._playing}get end(){return this._end}get dead(){return this._dead}get won(){return this._won}get size(){return this._size}get bombs(){return this._bombs}get last(){return this._last}get grid(){return this._grid}get firstSafe(){return this._firstSafe}get flags(){return this._flags.size}get opening(){return this._opening}get startTime(){return this._startTime}get endTime(){return this._endTime}init(){this._grid=g(S(this.size.height)).flatMap(e=>g(S(this.size.width)).map(t=>new se(q(t,e)))).collect(),this.randge=new G(S(this.size.size))}restart(e=this.size,t=this.bombs,i=this.firstSafe){this._size=e,this._bombs=t,this._last=t,this._opening=0,this._flags.clear(),this._firstSafe=i,this._playing=!1,this._end=!1,this._won=!1,this._dead=!1,this._startTime=null,this._endTime=null,this.init(),this.update()}async send(e){if(!this.end&&!this._lock){switch(this._lock=!0,e.type){case"open":this.playing?await this.openCell(e.pos,e.cell):await this.start(e.pos,e.cell);break;case"round":this.stopPreview(),this.playing&&await this.openRound(e.pos,e.cell);break;case"flag":this.setFlag(e.cell);break;case"preview":this.preview(e.pos,e.cell);break}this._lock=!1}}async start(e,t){this._playing=!0,this._startTime=new Date,this.genBombs(e),await this.openSpace(e,t),this.update()}genBombs(e){const t=[k(e.index(this.size),i=>b(i-this.firstSafe,i+this.firstSafe)),...g(E(1,this.firstSafe)).flatMap(i=>[k(e.mapY(s=>s-i).index(this.size),s=>b(s-this.firstSafe,s+this.firstSafe)),k(e.mapY(s=>s+i).index(this.size),s=>b(s-this.firstSafe,s+this.firstSafe))])];for(const i of g(this.randge).filter(s=>!g(t).any(r=>U(r,s))).take(this.bombs).map(s=>this.grid[s]))i.hasBomb=!0;for(const[i,s]of g(this.grid).enumerate())w.byIndex(s,this.size).forRound(this.size,r=>{this.grid[r.index(this.size)].hasBomb&&i.num++})}async openSpace(e,t){if(t.hasFlag)return;if(t.hasBomb)return this.die(t);t.open||(t.open=!0,this._opening++);let i=new Map([[e,null]]),s=new Map;try{do{for(const[r,d]of i)r.forRoundWithDire(this.size,m=>!x.same(m,d),(m,_)=>{const p=this.grid[m.index(this.size)];if(!(p.open||p.hasFlag)){if(p.hasBomb)throw this.die(p),R;p.open||(p.open=!0,this._opening++),p.num==0&&!p.hasBomb&&s.set(m,x.rev(_))}});i.clear(),[i,s]=[s,i]}while(i.size)}catch(r){if(r===R)return}!this.checkWin()}async openCell(e,t){if(!t.open&&!t.hasFlag){if(t.hasBomb)return this.die(t);if(t.num==0)return await this.openSpace(e,t);t.open=!0,this._opening++,!this.checkWin()&&this.update()}}async openRound(e,t){if(!t.open)return;let i=0;e.forRound(this.size,s=>{this.grid[s.index(this.size)].hasFlag&&i++}),i===t.num&&(this.openSpace(e,t),this.update())}setFlag(e){e.open||(e.hasFlag?(e.hasFlag=!1,this._last++,this._flags.delete(e)):(e.hasFlag=!0,this._last--,this._flags.add(e)),this.update())}preview(e,t){this.clearPreview(),this._preview.push(t),t.preview=!0,e.forRound(this.size,i=>{const s=this.grid[i.index(this.size)];s.hasFlag||(s.preview=!0,this._preview.push(s))}),this.update()}clearPreview(){for(const e of this._preview)e.preview=!1;this._preview.length=0}stopPreview(){this._preview.length>0&&(this.clearPreview(),this.update())}die(e){this._endTime=new Date,e.boom=!0,this._end=!0,this._dead=!0,this.clearPreview(),this.update()}checkWin(){return this.size.size-this.opening===this.bombs?(this.win(),!0):!1}win(){this._endTime=new Date,this._last=0,this._end=!0,this._won=!0,this.clearPreview(),this.update()}}const j=f.exports.createContext(null);function te(){return f.exports.useContext(j)}class se{constructor(e){a(this,"hasBomb",!1);a(this,"hasFlag",!1);a(this,"open",!1);a(this,"preview",!1);a(this,"boom",!1);a(this,"num",0);this.pos=e}}function ie(){const n=N(),e=f.exports.useState(()=>new R(n))[0];return h(j.Provider,{value:e,children:h(ee,{theme:"xp"})})}const C=document.getElementById("root");C.addEventListener("contextmenu",n=>n.preventDefault());W.render(h(I.StrictMode,{children:h(ie,{})}),C);

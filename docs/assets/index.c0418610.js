var O=Object.defineProperty;var P=(n,e,t)=>e in n?O(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var o=(n,e,t)=>(P(n,typeof e!="symbol"?e+"":e,t),t);import{M as u,r as x,s as c,j as z,a as p,u as E,b as N,c as S,d as w,e as W,f as T,g as A,R as q,h as I}from"./vendor.58c45133.js";const Y=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const h of s)if(h.type==="childList")for(const m of h.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&i(m)}).observe(document,{childList:!0,subtree:!0});function t(s){const h={};return s.integrity&&(h.integrity=s.integrity),s.referrerpolicy&&(h.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?h.credentials="include":s.crossorigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function i(s){if(s.ep)return;s.ep=!0;const h=t(s);fetch(s.href,h)}};Y();var y;(function(n){function e(i){switch(i){case"up":return"down";case"down":return"up";case"left":return"right";case"right":return"left";case"upLeft":return"downRight";case"upRight":return"downLeft";case"downLeft":return"upRight";case"downRight":return"upLeft"}}n.rev=e;function t(i,s){switch(i){case null:case void 0:return s==null;case"up":return s==="up"||s==="upLeft"||s==="upRight";case"down":return s==="down"||s==="downLeft"||s==="downRight";case"left":return s==="left"||s==="upLeft"||s==="downLeft";case"right":return s==="right"||s==="upRight"||s==="downRight";case"upLeft":return s==="upLeft"||s==="up"||s==="left";case"upRight":return s==="upRight"||s==="up"||s==="right";case"downLeft":return s==="downLeft"||s==="down"||s==="left";case"downRight":return s==="downRight"||s==="down"||s==="right"}}n.same=t})(y||(y={}));class _{constructor(e,t){this.x=e,this.y=t}static byIndex(e,t){return new _(e%t.width,e/t.width|0)}get str(){return`${this.x},${this.y}`}index(e){return this.y*e.width+this.x}mapX(e){return new _(e(this.x),this.y)}mapY(e){return new _(this.x,e(this.y))}left(e){return this.x>0?this.mapX(t=>t-1):null}right(e){return this.x<e.width-1?this.mapX(t=>t+1):null}up(e){return this.y>0?this.mapY(t=>t-1):null}down(e){return this.y<e.height-1?this.mapY(t=>t+1):null}upLeft(e){return this.up(e)?.left(e)}upRight(e){return this.up(e)?.right(e)}downLeft(e){return this.down(e)?.left(e)}downRight(e){return this.down(e)?.right(e)}forRound(e,t){u.then(this.up(e),t),u.then(this.down(e),t),u.then(this.left(e),t),u.then(this.right(e),t),u.then(this.upLeft(e),t),u.then(this.upRight(e),t),u.then(this.downLeft(e),t),u.then(this.downRight(e),t)}forRoundWithDire(e,t,i){t("up")&&u.then(this.up(e),s=>i(s,"up")),t("down")&&u.then(this.down(e),s=>i(s,"down")),t("left")&&u.then(this.left(e),s=>i(s,"left")),t("right")&&u.then(this.right(e),s=>i(s,"right")),t("upLeft")&&u.then(this.upLeft(e),s=>i(s,"upLeft")),t("upRight")&&u.then(this.upRight(e),s=>i(s,"upRight")),t("downLeft")&&u.then(this.downLeft(e),s=>i(s,"downLeft")),t("downRight")&&u.then(this.downRight(e),s=>i(s,"downRight"))}}function G(n,e){return new _(n,e)}class X{constructor(e){o(this,"bucket");this.bucket=[...e]}*[Symbol.iterator](){for(const e of x(this.bucket.length-1,0)){const t=Math.random()*e|0;yield([this.bucket[t],this.bucket[e]]=[this.bucket[e],this.bucket[t]])[1]}}}class K{constructor(e,t){this.width=e,this.height=t}get size(){return this.width*this.height}}function U(n,e){return new K(n,e)}function F(...n){return c(n).filter(e=>e).map(e=>typeof e=="string"?e:e instanceof Array?F(...e):c(Object.entries(e)).filter(([,t])=>t).map(([t])=>t).filter(t=>t).join(" ")).filter(e=>e).join(" ")}function M(...n){const e=F(...n);return e?` ${e}`:""}function H(n,e){const[t,i]=n.from>n.to?[n.to,n.from]:[n.from,n.to];return e>=t&&e<=i}const a=z.exports.jsx,R=z.exports.jsxs;function J({onRestart:n,face:e,last:t,startTime:i,endTime:s}){return R("div",{className:"bar flex justify-between items-center",children:[a(L,{n:t}),a(Q,{onRestart:n,face:e}),a(V,{startTime:i,endTime:s})]})}function Q({onRestart:n,face:e}){return a("div",{className:`face ${e}`,onClick:n})}function L({n}){const e=`${n|0}`.padStart(3,"0");return R("div",{className:"num flex",children:[a($,{n:e[0]??0}),a($,{n:e[1]??0}),a($,{n:e[2]??0})]})}function $({n}){return a("div",{className:"num-item",children:n!=null?a("div",{className:`n n-${n}`}):null})}function V({startTime:n,endTime:e}){const[t]=p.exports.useState({startTime:n,endTime:e});t.startTime=n,t.endTime=e;const i=p.exports.useRef(0),[s,h]=p.exports.useState(0);return p.exports.useEffect(()=>{const m=()=>{i.current=requestAnimationFrame(m);const{startTime:g,endTime:b}=t;if(g==null||b!=null)return;const f=new Date;console.log(f,g);const v=(f.getTime()-g.getTime())/1e3;v!=s&&h(v)};return m(),()=>{cancelAnimationFrame(i.current)}},[]),n==null?a(L,{n:0}):e!=null?a(L,{n:(e.getTime()-n.getTime())/1e3}):a(L,{n:s})}var Z=p.exports.forwardRef(function({cell:e,won:t,dead:i},s){return a("div",{ref:s,className:`cell${M({open:e.open||e.preview||e.boom||i&&(!e.hasBomb&&e.hasFlag||e.hasBomb&&!e.hasFlag),bomb:(e.open||t||i)&&e.hasBomb,flag:e.hasFlag||t&&e.hasBomb,boom:e.boom},e.open&&!e.hasBomb&&e.num?`n-${e.num}`:null)}`,pos:e.pos.str})});function ee({size:n,grid:e,onRestart:t,onMsg:i,won:s,dead:h,last:m,startTime:g,endTime:b}){const[f,v]=p.exports.useState(!0);E(()=>v(!1));const B=N(),[l]=p.exports.useState(()=>({buttons:0,cell:null,cell2dom:new Map,dom2cell:new WeakMap}));S("mousedown",r=>{switch(l.buttons=r.buttons,B(),l.buttons){case 3:case 4:const d=l.dom2cell.get(r.target)??null;d!=null&&(l.cell=d,i({type:"preview",pos:d.pos,cell:d}));break}}),S("mouseup",()=>{const r=l.cell;if(r!=null)switch(l.buttons){case 1:i({type:"open",pos:r.pos,cell:r});break;case 2:i({type:"flag",cell:r});break;case 3:case 4:i({type:"round",pos:r.pos,cell:r});break}l.buttons=0,B()}),S("mousemove",r=>{switch(l.buttons){case 3:case 4:const d=l.dom2cell.get(r.target)??null;d!=null&&(l.cell=d,i({type:"preview",pos:d.pos,cell:d}));break}});const D=s?"won":h?"dead":l.buttons!=0?"click":"normal";return R("div",{className:`board flex flex-col xp${M({won:s,dead:h})}`,children:[f?R("div",{className:"preload",children:[c(w(3)).map(r=>a("div",{className:`b${r+1}`},`b${r+1}`)),c(w(4)).map(r=>a("div",{className:`f${r+1}`},`f${r+1}`)),c(w(8)).map(r=>a("div",{className:`c${r+1}`},`c${r+1}`)),c(W(9)).map(r=>a("div",{className:`n${r}`},`n${r}`))]}):null,a(J,{onRestart:t,face:D,last:m,startTime:g,endTime:b}),a("div",{className:"grid",style:{gridTemplateColumns:`repeat(${n.width}, 1fr)`,gridTemplateRows:`repeat(${n.height}, 1fr)`},onMouseDown:r=>{l.cell=l.dom2cell.get(r.target)??null},children:e.map(r=>a(Z,{ref:d=>{d!=null&&(l.cell2dom.set(r,d),l.dom2cell.set(d,r))},cell:r,won:s,dead:h},r.pos.str))})]})}function te({theme:n}){const e=se(),t=p.exports.useMemo(()=>{switch(n){case"xp":default:return ee}},[n]);return a("div",{className:"game grid place-self-center",children:a(t,{size:e.size,grid:e.grid,won:e.won,dead:e.dead,last:e.last,startTime:e.startTime,endTime:e.endTime,onRestart:()=>e.restart(),onMsg:i=>e.send(i)})})}class k{constructor(e){o(this,"_lock",!1);o(this,"randge",null);o(this,"_playing",!1);o(this,"_end",!1);o(this,"_dead",!1);o(this,"_won",!1);o(this,"_size",U(9,9));o(this,"_bombs",10);o(this,"_last",this._bombs);o(this,"_grid",[]);o(this,"_firstSafe",1);o(this,"_flags",new Set);o(this,"_opening",0);o(this,"_startTime",null);o(this,"_endTime",null);o(this,"_preview",[]);this.update=e,this.init()}get playing(){return this._playing}get end(){return this._end}get dead(){return this._dead}get won(){return this._won}get size(){return this._size}get bombs(){return this._bombs}get last(){return this._last}get grid(){return this._grid}get firstSafe(){return this._firstSafe}get flags(){return this._flags.size}get opening(){return this._opening}get startTime(){return this._startTime}get endTime(){return this._endTime}init(){this._grid=c(w(this.size.height)).flatMap(e=>c(w(this.size.width)).map(t=>new ie(G(t,e)))).collect(),this.randge=new X(w(this.size.size))}restart(e=this.size,t=this.bombs,i=this.firstSafe){this._size=e,this._bombs=t,this._last=t,this._opening=0,this._flags.clear(),this._firstSafe=i,this._playing=!1,this._end=!1,this._won=!1,this._dead=!1,this._startTime=null,this._endTime=null,this.init(),this.update()}async send(e){if(!this.end&&!this._lock){switch(this._lock=!0,e.type){case"open":this.playing?await this.openCell(e.pos,e.cell):await this.start(e.pos,e.cell);break;case"round":this.stopPreview(),this.playing&&await this.openRound(e.pos,e.cell);break;case"flag":this.setFlag(e.cell);break;case"preview":this.preview(e.pos,e.cell);break}this._lock=!1}}async start(e,t){this._playing=!0,this._startTime=new Date,this.genBombs(e),await this.openSpace(e,t),this.update()}genBombs(e){const t=[T(e.index(this.size),i=>x(i-this.firstSafe,i+this.firstSafe)),...c(A(1,this.firstSafe)).flatMap(i=>[T(e.mapY(s=>s-i).index(this.size),s=>x(s-this.firstSafe,s+this.firstSafe)),T(e.mapY(s=>s+i).index(this.size),s=>x(s-this.firstSafe,s+this.firstSafe))])];console.log("start");for(const i of c(this.randge).filter(s=>!c(t).any(h=>H(h,s))).take(this.bombs).map(s=>this.grid[s]))i.hasBomb=!0;for(const[i,s]of c(this.grid).enumerate())_.byIndex(s,this.size).forRound(this.size,h=>{this.grid[h.index(this.size)].hasBomb&&i.num++})}async openSpace(e,t){if(t.hasFlag)return;if(t.hasBomb)return this.die(t);t.open||(t.open=!0,this._opening++);let i=new Map([[e,null]]),s=new Map;try{do{for(const[h,m]of i)h.forRoundWithDire(this.size,g=>!y.same(g,m),(g,b)=>{const f=this.grid[g.index(this.size)];if(!(f.open||f.hasFlag)){if(f.hasBomb)throw this.die(f),k;f.open||(f.open=!0,this._opening++),f.num==0&&!f.hasBomb&&s.set(g,y.rev(b))}});i.clear(),[i,s]=[s,i]}while(i.size)}catch(h){if(h===k)return}!this.checkWin()}async openCell(e,t){if(!t.open&&!t.hasFlag){if(t.hasBomb)return this.die(t);if(t.num==0)return await this.openSpace(e,t);t.open=!0,this._opening++,!this.checkWin()&&this.update()}}async openRound(e,t){if(!t.open)return;let i=0;e.forRound(this.size,s=>{this.grid[s.index(this.size)].hasFlag&&i++}),i===t.num&&(this.openSpace(e,t),this.update())}setFlag(e){e.open||(e.hasFlag?(e.hasFlag=!1,this._last++,this._flags.delete(e)):(e.hasFlag=!0,this._last--,this._flags.add(e)),this.update())}preview(e,t){this.clearPreview(),this._preview.push(t),t.preview=!0,e.forRound(this.size,i=>{const s=this.grid[i.index(this.size)];s.hasFlag||(s.preview=!0,this._preview.push(s))}),this.update()}clearPreview(){for(const e of this._preview)e.preview=!1;this._preview.length=0}stopPreview(){this._preview.length>0&&(this.clearPreview(),this.update())}die(e){this._endTime=new Date,e.boom=!0,this._end=!0,this._dead=!0,this.clearPreview(),this.update()}checkWin(){return console.log("checkWin",this.last,this.flags,this.bombs,this.size.size,this.opening,this.size.size-this.opening,this.size.size-this.opening===this.bombs||this.flags===this.bombs&&c(this._flags).all(e=>e.hasBomb)),this.size.size-this.opening===this.bombs||this.flags===this.bombs&&c(this._flags).all(e=>e.hasBomb)?(this.win(),!0):!1}win(){this._endTime=new Date,this._last=0,this._end=!0,this._won=!0,this.clearPreview(),this.update()}}const j=p.exports.createContext(null);function se(){return p.exports.useContext(j)}class ie{constructor(e){o(this,"hasBomb",!1);o(this,"hasFlag",!1);o(this,"open",!1);o(this,"preview",!1);o(this,"boom",!1);o(this,"num",0);this.pos=e}}function ne(){const n=N(),e=p.exports.useState(()=>new k(n))[0];return a(j.Provider,{value:e,children:a(te,{theme:"xp"})})}const C=document.getElementById("root");C.addEventListener("contextmenu",n=>n.preventDefault());q.render(a(I.StrictMode,{children:a(ne,{})}),C);
